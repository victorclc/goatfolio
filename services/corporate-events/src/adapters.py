import logging
import os
import re
from dataclasses import asdict
from decimal import Decimal
from io import StringIO
from typing import List

import boto3 as boto3
import requests
from boto3.dynamodb.conditions import Key, Attr
from sqlalchemy import create_engine

from goatcommons.constants import InvestmentsType
from goatcommons.models import Investment, StockInvestment
from goatcommons.utils import InvestmentUtils, JsonUtils
from model import CompanyCorporateEventsData, CorporateEvent, AsyncInvestmentAddRequest

logging.basicConfig(level=logging.INFO, format='%(asctime)s | %(funcName)s %(levelname)-s: %(message)s')
logger = logging.getLogger()
logger.setLevel(logging.INFO)


class InvestmentRepository:
    def __init__(self):
        self.__investments_table = boto3.resource('dynamodb').Table('Investments')

    def find_by_subject_and_ticker(self, subject, ticker):
        result = self.__investments_table.query(KeyConditionExpression=Key('subject').eq(subject),
                                                FilterExpression=Attr("ticker").eq(ticker))
        return list(map(lambda i: InvestmentUtils.load_model_by_type(i['type'], i), result['Items']))

    def find_by_subject(self, subject) -> List[Investment]:
        # result = self.__investments_table.query(KeyConditionExpression=Key('subject').eq(subject))
        result = {'Items': [
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1556593200'),
             'operation': 'BUY', 'ticker': 'KNRI11', 'costs': Decimal('0'), 'amount': Decimal('4'),
             'price': Decimal('150.55'), 'external_system': '', 'id': '02702e49-8f39-4b9e-8d02-5cc45d3e86a1',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1560481200'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('34'),
             'price': Decimal('37.75'), 'external_system': '', 'id': '0314c370-9dc9-4b76-aebb-e061c59072e8',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1556593200'),
             'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('20.81'), 'external_system': '', 'id': '0a61bd7c-6c4c-4313-b73d-dec77b7e90dd',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('13.2'), 'external_system': '', 'id': '0b1ef138-f124-44ff-87f7-7d8ac282452b',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1566356400'),
             'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'), 'amount': Decimal('51'),
             'price': Decimal('22.8'), 'external_system': '', 'id': '0d6e12a1-cd44-4457-9a72-1c6c7883879c',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1564542000'),
             'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'), 'amount': Decimal('30'),
             'price': Decimal('12.7'), 'external_system': '', 'id': '0df0bdd0-61c0-4657-a345-99daa2d9c998',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1554778800'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('11.85'), 'external_system': '', 'id': '125cbaf0-84b7-4b5a-a3a2-40e0b553fa26',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1566529200'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('8'),
             'price': Decimal('12.07'), 'external_system': '', 'id': '12c72b60-b3b4-478f-afd5-38b8f59c7d70',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '', 'date': Decimal('1557111600'),
             'operation': 'BUY', 'ticker': 'HGBS11', 'costs': Decimal('0'), 'amount': Decimal('3'),
             'price': Decimal('252.48'), 'external_system': '', 'id': '13ef4a0c-3dc9-4a7c-960d-4a7e256ca176',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567393200'),
             'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'), 'amount': Decimal('76'),
             'price': Decimal('22.62'), 'external_system': '', 'id': '13f62a0c-31e5-4906-9529-858454bd34a8',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568862000'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('11'),
             'price': Decimal('13.27'), 'external_system': '', 'id': '15e8891c-dba6-4da4-9785-d5e3a4421c4d',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'), 'amount': Decimal('15'),
             'price': Decimal('24.1'), 'external_system': '', 'id': '15f1eed4-0dab-4910-94e3-9c74b8ab55a8',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'), 'amount': Decimal('50'),
             'price': Decimal('12.09'), 'external_system': '', 'id': '1611b880-2c86-4edd-ae23-203839116abe',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1555297200'),
             'operation': 'BUY', 'ticker': 'BRCR11', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('93.43'), 'external_system': '', 'id': '1815d093-c1f2-4b92-bf23-17d4bf996664',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567393200'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('10'),
             'price': Decimal('60.33'), 'external_system': '', 'id': '1ce490c7-89b9-41ac-b961-3adb251fe68e',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1563159600'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('57'),
             'price': Decimal('39.11'), 'external_system': '', 'id': '1da65d3c-a03c-4f97-9e51-3fc71f52b1fd',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569898800'),
             'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('88'),
             'price': Decimal('15.57'), 'external_system': '', 'id': '2f1fb296-c2df-43a0-b9d6-784146434311',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'USIM5', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('7.92'), 'external_system': '', 'id': '35622780-72af-45ac-9804-8702d9c1ca6a',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('10'),
             'price': Decimal('56.3'), 'external_system': '', 'id': '371b50c4-3d87-4807-8762-7a06cbfdda58',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565838000'),
             'operation': 'BUY', 'ticker': 'USIM5', 'costs': Decimal('0'), 'amount': Decimal('101'),
             'price': Decimal('7.49'), 'external_system': '', 'id': '3841589a-d518-41e2-bd21-1f812010ecb9',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567393200'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('4'),
             'price': Decimal('12.26'), 'external_system': '', 'id': '3c901c47-f3e7-48bf-93d6-ac6fd50b2b86',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1554778800'),
             'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('23.04'), 'external_system': '', 'id': '455f0836-461f-47ee-9d48-62f32b898123',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565838000'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('345'),
             'price': Decimal('0'), 'external_system': '', 'id': '48a475d1-76a0-4586-b447-c89deb649e00',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'MODAL', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'HGBS11', 'costs': Decimal('0'), 'amount': Decimal('3'),
             'price': Decimal('755.7'), 'external_system': '', 'id': '4b003ea9-c0c1-44ee-a020-0cf2cb409580',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569466800'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('97'),
             'price': Decimal('61.5'), 'external_system': '', 'id': '4f6bd373-6893-49b7-841a-60213e563c95',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569985200'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('20'),
             'price': Decimal('51.47'), 'external_system': '', 'id': '507c4a57-eb1b-4cc3-8318-f75a6a6a10d8',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1566356400'),
             'operation': 'BUY', 'ticker': 'EMBR3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('17.89'), 'external_system': '', 'id': '51141f0e-9bdf-4831-97e0-45474d6f2cd7',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1557111600'),
             'operation': 'SELL', 'ticker': 'ECOR3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('8.41'), 'external_system': '', 'id': '51ac00a3-7546-4cd1-8560-09cc345196ad',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1564542000'),
             'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('18'),
             'price': Decimal('23.39'), 'external_system': '', 'id': '51b0c5d3-a4ce-4244-8696-afbe12184a3f',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1533610800'),
             'operation': 'BUY', 'ticker': 'HGBS11', 'costs': Decimal('0'), 'amount': Decimal('7'),
             'price': Decimal('200.5'), 'external_system': '', 'id': '55e79351-a19c-4cd2-87cf-e52acf164d1b',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1566183600'),
             'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('47'),
             'price': Decimal('54.1'), 'external_system': '', 'id': '5bc16899-19f9-4d96-9a99-551ade9f4555',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1559271600'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('11'),
             'price': Decimal('38.8'), 'external_system': '', 'id': '6ae227b3-45bf-4447-853c-27e7818b5750',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569898800'),
             'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('300'),
             'price': Decimal('15.59'), 'external_system': '', 'id': '6bdc694a-680e-497d-9637-1336277a68f4',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1602663098'),
             'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'), 'amount': Decimal('321'),
             'price': Decimal('0'), 'external_system': '', 'id': '77363f13-d167-455c-bd3b-5e6d3e983ec3',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1560481200'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('2'),
             'price': Decimal('37.65'), 'external_system': '', 'id': '7ef1d47c-9d5d-40bb-a497-89659960b0a6',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'EMBR3', 'costs': Decimal('0'), 'amount': Decimal('50'),
             'price': Decimal('18.67'), 'external_system': '', 'id': '81dcfe96-3db3-4602-a58a-0e79e7aa5096',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('15'),
             'price': Decimal('35.1'), 'external_system': '', 'id': '85d4c3ec-1f7d-4179-bdda-f3248e03be6e',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1555297200'),
             'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'), 'amount': Decimal('300'),
             'price': Decimal('10.8'), 'external_system': '', 'id': '8c321942-62ce-460c-9d1d-ce57ddf19d05',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('5'),
             'price': Decimal('57.9'), 'external_system': '', 'id': '8f4c4536-151a-403a-a2e1-b5cc5f6a0b68',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'USIM5', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('8.38'), 'external_system': '', 'id': '9319bc0c-850b-4971-9bd4-1a310ec8dd9e',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1556593200'),
             'operation': 'BUY', 'ticker': 'ECOR3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('8.08'), 'external_system': '', 'id': '94b33973-e82d-4edc-bd74-bd82d386f6aa',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565924400'),
             'operation': 'SELL', 'ticker': 'BRCR11', 'costs': Decimal('0'), 'amount': Decimal('7'),
             'price': Decimal('96.41'), 'external_system': '', 'id': '955f9cfd-b04f-4aae-8f4b-ccdc62b5364b',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Inter', 'date': Decimal('1615431600'),
             'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'), 'amount': Decimal('58'),
             'price': Decimal('88.27'), 'external_system': '', 'id': '98d0ddb1-2397-4d7a-af06-0ae6a72c1709',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567998000'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('5'),
             'price': Decimal('55.49'), 'external_system': '', 'id': '9a2ad951-1271-4122-a309-fa4ca26f17b2',
             'type': 'STOCK'}, {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
                                'date': Decimal('1618185600'), 'operation': 'BUY', 'ticker': 'AAPL34',
                                'costs': Decimal('0'), 'amount': Decimal('100'), 'price': Decimal('74.65'),
                                'external_system': 'CEI', 'id': 'CEIAAPL34161818560010074651', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1589932800'), 'operation': 'BUY', 'ticker': 'ALZR11', 'costs': Decimal('0'),
             'amount': Decimal('16'), 'price': Decimal('107.9'), 'external_system': 'CEI',
             'id': 'CEIALZR11158993280016107901', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1589932800'), 'operation': 'BUY', 'ticker': 'ALZR11', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('107.9'), 'external_system': 'CEI',
             'id': 'CEIALZR1115899328004107901', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1580342400'), 'operation': 'BUY', 'ticker': 'ARZZ3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('61.68'), 'external_system': 'CEI',
             'id': 'CEIARZZ315803424001061681', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'ARZZ3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('64.18'), 'external_system': 'CEI',
             'id': 'CEIARZZ316048800001064181', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584316800'), 'operation': 'BUY', 'ticker': 'AZUL4', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('17.5'), 'external_system': 'CEI',
             'id': 'CEIAZUL4158431680010017501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1595289600'), 'operation': 'SELL', 'ticker': 'AZUL4', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('21.92'), 'external_system': 'CEI',
             'id': 'CEIAZUL4159528960010021921', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'BUY', 'ticker': 'BABA34', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('49.2'), 'external_system': 'CEI',
             'id': 'CEIBABA34161818560010049201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1613952000'), 'operation': 'BUY', 'ticker': 'BBAS3', 'costs': Decimal('0'),
             'amount': Decimal('200'), 'price': Decimal('29.01'), 'external_system': 'CEI',
             'id': 'CEIBBAS3161395200020029011', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1589932800'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('12'), 'price': Decimal('84.4'), 'external_system': 'CEI',
             'id': 'CEIBCFF1115899328001284401', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('2'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600290571', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('3'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600390571', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600490571', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600490572', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600590571', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('90.57'), 'external_system': 'CEI',
             'id': 'CEIBCFF111602201600590572', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('19'), 'price': Decimal('85.65'), 'external_system': 'CEI',
             'id': 'CEIBCFF1116181856001985651', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('2'), 'price': Decimal('85.65'), 'external_system': 'CEI',
             'id': 'CEIBCFF111618185600285651', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'BUY', 'ticker': 'BCFF11', 'costs': Decimal('0'),
             'amount': Decimal('3'), 'price': Decimal('85.65'), 'external_system': 'CEI',
             'id': 'CEIBCFF111618185600385651', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('46.58'), 'external_system': 'CEI',
             'id': 'CEIBIDI111570665600546581', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582675200'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('44.2'), 'external_system': 'CEI',
             'id': 'CEIBIDI1115826752001044201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('1'), 'price': Decimal('39'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583452800139001', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('39'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583452800439001', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('39'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583452800539001', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583712000'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('15'), 'price': Decimal('31.6'), 'external_system': 'CEI',
             'id': 'CEIBIDI1115837120001531601', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('29.4'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583884800429401', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('7'), 'price': Decimal('29.4'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583884800729401', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('23.4'), 'external_system': 'CEI',
             'id': 'CEIBIDI1115839712001023401', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('25'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583971200525001', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('25'), 'external_system': 'CEI',
             'id': 'CEIBIDI111583971200525002', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1587686400'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('25.96'), 'external_system': 'CEI',
             'id': 'CEIBIDI11158768640010025961', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1600646400'), 'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('25'), 'price': Decimal('51.5'), 'external_system': 'CEI',
             'id': 'CEIBIDI1116006464002551501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('40'), 'price': Decimal('60.06'), 'external_system': 'CEI',
             'id': 'CEIBIDI1116048800004060061', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1614902400'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('22'), 'price': Decimal('160.5'), 'external_system': 'CEI',
             'id': 'CEIBIDI11161490240022160501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1614902400'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('7'), 'price': Decimal('160.5'), 'external_system': 'CEI',
             'id': 'CEIBIDI1116149024007160501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('31'), 'price': Decimal('188.02'), 'external_system': 'CEI',
             'id': 'CEIBIDI11161818560031188021', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('45'), 'price': Decimal('188.01'), 'external_system': 'CEI',
             'id': 'CEIBIDI11161818560045188011', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1618185600'), 'operation': 'SELL', 'ticker': 'BIDI11', 'costs': Decimal('0'),
             'amount': Decimal('6'), 'price': Decimal('188.01'), 'external_system': 'CEI',
             'id': 'CEIBIDI1116181856006188011', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1982 - MODAL DTVM LTDA',
             'date': Decimal('1572220800'), 'operation': 'SELL', 'ticker': 'CEAB3', 'costs': Decimal('0'),
             'amount': Decimal('300'), 'price': Decimal('17.33'), 'external_system': 'CEI',
             'id': 'CEICEAB3157222080030017331', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1982 - MODAL DTVM LTDA',
             'date': Decimal('1572220800'), 'operation': 'SELL', 'ticker': 'CEAB3', 'costs': Decimal('0'),
             'amount': Decimal('35'), 'price': Decimal('17.23'), 'external_system': 'CEI',
             'id': 'CEICEAB315722208003517231', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('17.11'), 'external_system': 'CEI',
             'id': 'CEIEMBR315706656001017111', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('18.14'), 'external_system': 'CEI',
             'id': 'CEIEMBR3157308480010018141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('18.14'), 'external_system': 'CEI',
             'id': 'CEIEMBR315730848001018141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('2'), 'price': Decimal('18.2'), 'external_system': 'CEI',
             'id': 'CEIEMBR31573084800218201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('31'), 'price': Decimal('18.14'), 'external_system': 'CEI',
             'id': 'CEIEMBR315730848003118141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('34'), 'price': Decimal('18.14'), 'external_system': 'CEI',
             'id': 'CEIEMBR315730848003418141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'EMBR3', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('18.14'), 'external_system': 'CEI',
             'id': 'CEIEMBR31573084800418141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('1'), 'price': Decimal('26.2'), 'external_system': 'CEI',
             'id': 'CEIFLRY31573084800126201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('1'), 'price': Decimal('26.21'), 'external_system': 'CEI',
             'id': 'CEIFLRY31573084800126211', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('20'), 'price': Decimal('26.2'), 'external_system': 'CEI',
             'id': 'CEIFLRY315730848002026201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('33'), 'price': Decimal('26.2'), 'external_system': 'CEI',
             'id': 'CEIFLRY315730848003326201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('20'), 'price': Decimal('24.68'), 'external_system': 'CEI',
             'id': 'CEIFLRY315838848002024681', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('25'), 'price': Decimal('19.78'), 'external_system': 'CEI',
             'id': 'CEIFLRY315844896002519781', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'FLRY3', 'costs': Decimal('0'),
             'amount': Decimal('13'), 'price': Decimal('28.88'), 'external_system': 'CEI',
             'id': 'CEIFLRY316048800001328881', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570492800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('14'), 'price': Decimal('12.26'), 'external_system': 'CEI',
             'id': 'CEIITSA415704928001412261', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570492800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('12.26'), 'external_system': 'CEI',
             'id': 'CEIITSA41570492800512261', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1580428800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('39'), 'price': Decimal('12.78'), 'external_system': 'CEI',
             'id': 'CEIITSA415804288003912781', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582675200'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('36'), 'price': Decimal('12.2'), 'external_system': 'CEI',
             'id': 'CEIITSA415826752003612201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582675200'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('12.2'), 'external_system': 'CEI',
             'id': 'CEIITSA41582675200512201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('8'), 'price': Decimal('11.45'), 'external_system': 'CEI',
             'id': 'CEIITSA41583452800811451', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('9'), 'price': Decimal('11.45'), 'external_system': 'CEI',
             'id': 'CEIITSA41583452800911451', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('9.97'), 'external_system': 'CEI',
             'id': 'CEIITSA41583884800109971', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('30'), 'price': Decimal('10.27'), 'external_system': 'CEI',
             'id': 'CEIITSA415838848003010271', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('30'), 'price': Decimal('9.11'), 'external_system': 'CEI',
             'id': 'CEIITSA41583971200309111', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('18'), 'price': Decimal('9.13'), 'external_system': 'CEI',
             'id': 'CEIITSA41584489600189131', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('37'), 'price': Decimal('9.13'), 'external_system': 'CEI',
             'id': 'CEIITSA41584489600379131', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1587686400'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('8.38'), 'external_system': 'CEI',
             'id': 'CEIITSA415876864001008381', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1600646400'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('8.97'), 'external_system': 'CEI',
             'id': 'CEIITSA416006464001008971', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('1'), 'price': Decimal('10.38'), 'external_system': 'CEI',
             'id': 'CEIITSA41604880000110381', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('21'), 'price': Decimal('10.38'), 'external_system': 'CEI',
             'id': 'CEIITSA416048800002110381', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'),
             'amount': Decimal('62'), 'price': Decimal('10.38'), 'external_system': 'CEI',
             'id': 'CEIITSA416048800006210381', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1589932800'), 'operation': 'BUY', 'ticker': 'IVVB11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('181.92'), 'external_system': 'CEI',
             'id': 'CEIIVVB11158993280010181921', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1594252800'), 'operation': 'BUY', 'ticker': 'IVVB11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('179.46'), 'external_system': 'CEI',
             'id': 'CEIIVVB11159425280010179461', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'MDIA3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('35.14'), 'external_system': 'CEI',
             'id': 'CEIMDIA3160488000010035141', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'MDIA3', 'costs': Decimal('0'),
             'amount': Decimal('56'), 'price': Decimal('35.11'), 'external_system': 'CEI',
             'id': 'CEIMDIA316048800005635111', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582761600'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('52.26'), 'external_system': 'CEI',
             'id': 'CEIMGLU315827616001052261', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583366400'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('49.05'), 'external_system': 'CEI',
             'id': 'CEIMGLU315833664001049051', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('44.07'), 'external_system': 'CEI',
             'id': 'CEIMGLU31583452800544071', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583712000'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('39.68'), 'external_system': 'CEI',
             'id': 'CEIMGLU315837120001039681', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('34.32'), 'external_system': 'CEI',
             'id': 'CEIMGLU315839712001034321', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('31.54'), 'external_system': 'CEI',
             'id': 'CEIMGLU31583971200531541', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('15'), 'price': Decimal('33.13'), 'external_system': 'CEI',
             'id': 'CEIMGLU315844896001533131', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('95.7'), 'external_system': 'CEI',
             'id': 'CEIMGLU316022016001095701', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1602201600'), 'operation': 'BUY', 'ticker': 'MGLU3', 'costs': Decimal('0'),
             'amount': Decimal('32'), 'price': Decimal('95.7'), 'external_system': 'CEI',
             'id': 'CEIMGLU316022016003295701', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'MYPK3', 'costs': Decimal('0'),
             'amount': Decimal('2'), 'price': Decimal('12.74'), 'external_system': 'CEI',
             'id': 'CEIMYPK31583971200212741', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583971200'), 'operation': 'BUY', 'ticker': 'MYPK3', 'costs': Decimal('0'),
             'amount': Decimal('48'), 'price': Decimal('12.74'), 'external_system': 'CEI',
             'id': 'CEIMYPK315839712004812741', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1587686400'), 'operation': 'BUY', 'ticker': 'MYPK3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('12'), 'external_system': 'CEI',
             'id': 'CEIMYPK315876864001012001', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1587686400'), 'operation': 'BUY', 'ticker': 'MYPK3', 'costs': Decimal('0'),
             'amount': Decimal('40'), 'price': Decimal('12.19'), 'external_system': 'CEI',
             'id': 'CEIMYPK315876864004012191', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1594252800'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('23'), 'price': Decimal('90.2'), 'external_system': 'CEI',
             'id': 'CEIRBRP1115942528002390201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1597104000'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('19'), 'price': Decimal('88.1'), 'external_system': 'CEI',
             'id': 'CEIRBRP1115971040001988101', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1597104000'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('22'), 'price': Decimal('88.1'), 'external_system': 'CEI',
             'id': 'CEIRBRP1115971040002288101', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1599696000'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('16'), 'price': Decimal('91.07'), 'external_system': 'CEI',
             'id': 'CEIRBRP1115996960001691071', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1605139200'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('92.2'), 'external_system': 'CEI',
             'id': 'CEIRBRP1116051392001092201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1605139200'), 'operation': 'BUY', 'ticker': 'RBRP11', 'costs': Decimal('0'),
             'amount': Decimal('36'), 'price': Decimal('92.2'), 'external_system': 'CEI',
             'id': 'CEIRBRP1116051392003692201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('14.9'), 'external_system': 'CEI',
             'id': 'CEISQIA315706656001014901', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1571011200'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('15.07'), 'external_system': 'CEI',
             'id': 'CEISQIA31571011200515071', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1573084800'), 'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('87'), 'price': Decimal('17.09'), 'external_system': 'CEI',
             'id': 'CEISQIA315730848008717091', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1580342400'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('15'), 'price': Decimal('25.11'), 'external_system': 'CEI',
             'id': 'CEISQIA315803424001525111', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582675200'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('16'), 'price': Decimal('24.71'), 'external_system': 'CEI',
             'id': 'CEISQIA315826752001624711', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582675200'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('9'), 'price': Decimal('24.71'), 'external_system': 'CEI',
             'id': 'CEISQIA31582675200924711', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582848000'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('18'), 'price': Decimal('21.75'), 'external_system': 'CEI',
             'id': 'CEISQIA315828480001821751', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582848000'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('3'), 'price': Decimal('21.69'), 'external_system': 'CEI',
             'id': 'CEISQIA31582848000321691', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1582848000'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('21.69'), 'external_system': 'CEI',
             'id': 'CEISQIA31582848000421691', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583366400'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('25'), 'price': Decimal('21.87'), 'external_system': 'CEI',
             'id': 'CEISQIA315833664002521871', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583452800'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('20'), 'price': Decimal('19.39'), 'external_system': 'CEI',
             'id': 'CEISQIA315834528002019391', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1583884800'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('17.04'), 'external_system': 'CEI',
             'id': 'CEISQIA315838848001017041', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('11.34'), 'external_system': 'CEI',
             'id': 'CEISQIA3158448960010011341', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('35'), 'price': Decimal('13.6'), 'external_system': 'CEI',
             'id': 'CEISQIA315844896003513601', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('22.5'), 'external_system': 'CEI',
             'id': 'CEISQIA31604880000422501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('22.5'), 'external_system': 'CEI',
             'id': 'CEISQIA31604880000522501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'SQIA3', 'costs': Decimal('0'),
             'amount': Decimal('6'), 'price': Decimal('22.5'), 'external_system': 'CEI',
             'id': 'CEISQIA31604880000622501', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'),
             'amount': Decimal('10'), 'price': Decimal('11.84'), 'external_system': 'CEI',
             'id': 'CEITIET1115706656001011841', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'),
             'amount': Decimal('16'), 'price': Decimal('11.82'), 'external_system': 'CEI',
             'id': 'CEITIET1115706656001611821', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'SELL', 'ticker': 'USIM5', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('7.58'), 'external_system': 'CEI',
             'id': 'CEIUSIM515706656001007581', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'SELL', 'ticker': 'USIM5', 'costs': Decimal('0'),
             'amount': Decimal('4'), 'price': Decimal('7.58'), 'external_system': 'CEI',
             'id': 'CEIUSIM5157066560047581', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1614297600'), 'operation': 'BUY', 'ticker': 'VALE3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('96.55'), 'external_system': 'CEI',
             'id': 'CEIVALE3161429760010096551', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1614902400'), 'operation': 'SELL', 'ticker': 'VALE3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('94.6'), 'external_system': 'CEI',
             'id': 'CEIVALE3161490240010094601', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1612828800'), 'operation': 'BUY', 'ticker': 'VGIP11', 'costs': Decimal('0'),
             'amount': Decimal('71'), 'price': Decimal('114.4'), 'external_system': 'CEI',
             'id': 'CEIVGIP11161282880071114401', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1570665600'), 'operation': 'SELL', 'ticker': 'VIVA3', 'costs': Decimal('0'),
             'amount': Decimal('8'), 'price': Decimal('24.71'), 'external_system': 'CEI',
             'id': 'CEIVIVA31570665600824711', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'VVAR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('4.89'), 'external_system': 'CEI',
             'id': 'CEIVVAR315844896001004891', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'VVAR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('5.97'), 'external_system': 'CEI',
             'id': 'CEIVVAR315844896001005971', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1585699200'), 'operation': 'BUY', 'ticker': 'VVAR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('4.67'), 'external_system': 'CEI',
             'id': 'CEIVVAR315856992001004671', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1595289600'), 'operation': 'SELL', 'ticker': 'VVAR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('20.76'), 'external_system': 'CEI',
             'id': 'CEIVVAR3159528960010020761', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1595289600'), 'operation': 'SELL', 'ticker': 'VVAR3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('20.8'), 'external_system': 'CEI',
             'id': 'CEIVVAR3159528960010020801', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1570665600'), 'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'),
             'amount': Decimal('5'), 'price': Decimal('23.08'), 'external_system': 'CEI',
             'id': 'CEIWEGE31570665600523081', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1584489600'), 'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'),
             'amount': Decimal('20'), 'price': Decimal('26.28'), 'external_system': 'CEI',
             'id': 'CEIWEGE315844896002026281', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1585699200'), 'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'),
             'amount': Decimal('15'), 'price': Decimal('32.2'), 'external_system': 'CEI',
             'id': 'CEIWEGE315856992001532201', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1587686400'), 'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'),
             'amount': Decimal('15'), 'price': Decimal('37.08'), 'external_system': 'CEI',
             'id': 'CEIWEGE315876864001537081', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '308 - CLEAR CORRETORA - GRUPO XP',
             'date': Decimal('1604880000'), 'operation': 'SELL', 'ticker': 'WEGE3', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('83.71'), 'external_system': 'CEI',
             'id': 'CEIWEGE3160488000010083711', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': '1099 - INTER DTVM LTDA',
             'date': Decimal('1615248000'), 'operation': 'BUY', 'ticker': 'XINA11', 'costs': Decimal('0'),
             'amount': Decimal('100'), 'price': Decimal('11.93'), 'external_system': 'CEI',
             'id': 'CEIXINA11161524800010011931', 'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1554778800'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('90'),
             'price': Decimal('11.88'), 'external_system': '', 'id': 'a3098726-f8d8-4139-898e-0b74342ed1d3',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1553828400'),
             'operation': 'BUY', 'ticker': 'HGBS11', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('253.8'), 'external_system': '', 'id': 'a544c737-f922-476c-9b4f-376056aaf334',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'MODAL', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'HGBS11', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('251.94'), 'external_system': '', 'id': 'ab63b161-ed26-412c-a1d7-4093000f6119',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1555297200'),
             'operation': 'BUY', 'ticker': 'KNRI11', 'costs': Decimal('0'), 'amount': Decimal('3'),
             'price': Decimal('152.78'), 'external_system': '', 'id': 'ade15786-2b4c-4925-a678-a8ec26788bdb',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1553482800'),
             'operation': 'BUY', 'ticker': 'HGLG11', 'costs': Decimal('0'), 'amount': Decimal('12'),
             'price': Decimal('159.14'), 'external_system': '', 'id': 'b11410d0-6d50-4160-bcf5-d5215b03c00f',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('11'),
             'price': Decimal('35.44'), 'external_system': '', 'id': 'b57abbdd-23d0-4f64-bedc-40991106a95b',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1553482800'),
             'operation': 'BUY', 'ticker': 'BRCR11', 'costs': Decimal('0'), 'amount': Decimal('8'),
             'price': Decimal('96.67'), 'external_system': '', 'id': 'bf5c0692-601e-43ba-a941-3c60ee89eeef',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565924400'),
             'operation': 'SELL', 'ticker': 'BRCR11', 'costs': Decimal('0'), 'amount': Decimal('2'),
             'price': Decimal('96.47'), 'external_system': '', 'id': 'bfd8a659-6b91-4359-be75-47798891b169',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565838000'),
             'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'), 'amount': Decimal('72'),
             'price': Decimal('22.74'), 'external_system': '', 'id': 'c80e3030-3d7a-47dc-82b4-e44a26fa73cf',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1556074800'),
             'operation': 'BUY', 'ticker': 'KNRI11', 'costs': Decimal('0'), 'amount': Decimal('3'),
             'price': Decimal('151.8'), 'external_system': '', 'id': 'cd60d9fa-7971-4111-ad85-fc71bcafa688',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1553482800'),
             'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('19.9'), 'external_system': '', 'id': 'cd62029e-28a9-45f2-ae8e-8d3fa73037fb',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'BIDI11', 'costs': Decimal('0'), 'amount': Decimal('5'),
             'price': Decimal('57.86'), 'external_system': '', 'id': 'd2bf9ab5-c2e7-4455-a37e-bc6f7ca9d2f2',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1563937200'),
             'operation': 'BUY', 'ticker': 'TIET11', 'costs': Decimal('0'), 'amount': Decimal('10'),
             'price': Decimal('12.72'), 'external_system': '', 'id': 'd77ecc88-be27-47c8-82cb-f202bf9e15c1',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('15'),
             'price': Decimal('35.18'), 'external_system': '', 'id': 'dab6f9be-44d8-4603-82d8-5954a5844b26',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('5'),
             'price': Decimal('61.34'), 'external_system': '', 'id': 'de41633e-59ef-449c-9c3d-d43d222b6a31',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1568775600'),
             'operation': 'BUY', 'ticker': 'SQIA3', 'costs': Decimal('0'), 'amount': Decimal('13'),
             'price': Decimal('64.85'), 'external_system': '', 'id': 'e0389021-191a-45e8-802d-18031bc0fba4',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1569380400'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('2'),
             'price': Decimal('13.02'), 'external_system': '', 'id': 'e2ad96de-f5fd-438b-9d81-23443334df78',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'Modal', 'date': Decimal('1553482800'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('12.04'), 'external_system': '', 'id': 'e3ee55a8-3873-4753-ab30-7d5200602863',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567998000'),
             'operation': 'BUY', 'ticker': 'EMBR3', 'costs': Decimal('0'), 'amount': Decimal('21'),
             'price': Decimal('18.35'), 'external_system': '', 'id': 'e7f2828b-c6ff-4bec-8b77-273ed6dd9594',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1570158000'),
             'operation': 'BUY', 'ticker': 'ITSA4', 'costs': Decimal('0'), 'amount': Decimal('100'),
             'price': Decimal('12.63'), 'external_system': '', 'id': 'eb716ff6-f062-489b-8992-a8955f7cca4b',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1559271600'),
             'operation': 'BUY', 'ticker': 'WEGE3', 'costs': Decimal('0'), 'amount': Decimal('1'),
             'price': Decimal('19.08'), 'external_system': '', 'id': 'f10daa9b-1e6b-4eb9-882c-c7e80547bfcd',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1560481200'),
             'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('19'),
             'price': Decimal('21.05'), 'external_system': '', 'id': 'f37c29c8-3226-494a-b59f-0e9a479f645f',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567393200'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('15'),
             'price': Decimal('36.39'), 'external_system': '', 'id': 'f95c319b-6d2d-4015-8693-af9fd34a6034',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1565838000'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('16'),
             'price': Decimal('36.7'), 'external_system': '', 'id': 'fd070191-cf2b-49a9-b7ea-906423b51951',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1560481200'),
             'operation': 'BUY', 'ticker': 'FLRY3', 'costs': Decimal('0'), 'amount': Decimal('31'),
             'price': Decimal('21.04'), 'external_system': '', 'id': 'ff3c14ef-26b8-4820-8496-f1d05bbc8bf4',
             'type': 'STOCK'},
            {'subject': '440b0d96-395d-48bd-aaf2-58dbf7e68274', 'broker': 'CLEAR', 'date': Decimal('1567393200'),
             'operation': 'BUY', 'ticker': 'MDIA3', 'costs': Decimal('0'), 'amount': Decimal('27'),
             'price': Decimal('36.11'), 'external_system': '', 'id': 'ffb6e381-12fc-4d5d-9627-06816db12211',
             'type': 'STOCK'}], 'Count': 200, 'ScannedCount': 200,
            'ResponseMetadata': {'RequestId': 'RUMOT3JQ9T32J3685T4BFKEN93VV4KQNSO5AEMVJF66Q9ASUAAJG',
                                 'HTTPStatusCode': 200,
                                 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 15 Apr 2021 02:50:16 GMT',
                                                 'content-type': 'application/x-amz-json-1.0',
                                                 'content-length': '63798', 'connection': 'keep-alive',
                                                 'x-amzn-requestid': 'RUMOT3JQ9T32J3685T4BFKEN93VV4KQNSO5AEMVJF66Q9ASUAAJG',
                                                 'x-amz-crc32': '338291523'}, 'RetryAttempts': 0}}
        print(f'RESULT: {result}')

        return list(map(lambda i: InvestmentUtils.load_model_by_type(i['type'], i), result['Items']))


class B3CorporateEventsData:
    URL = 'https://sistemaswebb3-listados.b3.com.br/dividensOtherCorpActProxy/DivOtherCorpActCall/GetListDivOtherCorpActions/eyJsYW5ndWFnZSI6InB0LWJyIn0='
    DATE_FORMAT = '%d/%m/%Y'
    ALTERNATIVE_DATE_FORMAT = '%m/%d/%Y'  # for some reason sometimes de API return day/month/year and other times month/day/year

    def get_updated_corporate_events_link(self, date) -> List[CompanyCorporateEventsData]:
        data = requests.get(self.URL, verify=False).json()
        logger.info(f'b3 corporate events response: {data}')
        filtered_data = list(filter(lambda i: i['date'] == date.strftime(self.DATE_FORMAT), data))
        if not filtered_data:
            logger.info('trying alternative date format')
            filtered_data = list(
                filter(lambda i: i['date'] == date.strftime(self.ALTERNATIVE_DATE_FORMAT), data))

        if not filtered_data:
            logger.info(f'No corporate events for {date.strftime(self.DATE_FORMAT)}')
            return []
        return list(map(
            lambda i: CompanyCorporateEventsData(company_name=i['companyName'], trading_name=i['tradingName'],
                                                 code=i['code'],
                                                 segment=i['segment'], code_cvm=i['codeCvm'],
                                                 url=re.sub(r'en-US$', 'pt-BR', i['url'])),
            filtered_data[0]['results']))


class B3CorporateEventsBucket:
    def __init__(self):
        self.s3 = boto3.client('s3')
        self._downloaded_files = []
        self.bucket_name = os.getenv('CORPORATE_BUCKET')

    def download_file(self, bucket, file_path):
        destination = f"/tmp/{file_path.split('/')[-1]}"
        logger.info(f'Downloading to: {destination}')
        self.s3.download_file(bucket, file_path, destination)
        logger.info(f'Download finish')
        self._downloaded_files.append(destination)
        return destination

    def put(self, buffer: StringIO, file_name):
        self.s3.put_object(Body=buffer.getvalue(), Bucket=self.bucket_name, Key=f'new/{file_name}')

    def move_file_to_archive(self, bucket, file_path):
        self.s3.copy_object(Bucket=bucket, CopySource=f'{bucket}/{file_path}', Key=f"archive/{file_path}")
        self.s3.delete_object(Bucket=bucket, Key=file_path)

    def clean_up(self):
        for file in self._downloaded_files:
            os.system(f'rm -f {file}')


class CorporateEventsRepository:
    def __init__(self):
        _secrets_client = boto3.client("secretsmanager")
        secret = JsonUtils.load(_secrets_client.get_secret_value(
            SecretId='rds-db-credentials/cluster-B7EKYQNIWMBMYI6I6DNK6ICBEE/postgres')['SecretString'])
        self._username = secret['username']
        self._password = secret['password']
        self._port = secret['port']
        self._host = secret['host']

        self._engine = None

    def get_engine(self):
        if self._engine is None:
            self._engine = create_engine(
                f'postgresql://{self._username}:{self._password}@{self._host}:{self._port}/marketdata')
        return self._engine

    def get_dev_engine(self):
        # TODO remove this
        if self._engine is None:
            self._engine = create_engine(
                f'postgresql://postgres:postgres@localhost:5432/postgres')
        return self._engine

    def get_isin_code_from_ticker(self, ticker):
        return 'BRMGLUACNOR2'
        # engine = self.get_engine()
        # result = engine.execute(f"SELECT isin_code FROM b3_monthly_chart where ticker = '{ticker}' limit 1")
        # for row in result:
        #     return row[0]

    def get_corporate_events(self, isin_code, date):
        engine = self.get_dev_engine()
        result = engine.execute(
            f"SELECT proventos, codigo_isin, deliberado_em, negocios_com_ate, fator_de_grupamento_perc, ativo_emitido, observacoes "
            f"FROM b3_corporate_events where codigo_isin = '{isin_code}'")
        events = list(map(lambda data: CorporateEvent(*data), result))
        return list(sorted(filter(lambda e: e.negocios_com_ate >= date, events), key=lambda e: e.negocios_com_ate))


class AsyncPortfolioQueue:
    QUEUE_NAME = 'AddInvestmentQueue'

    def __init__(self):
        self._queue = boto3.resource('sqs').get_queue_by_name(QueueName=self.QUEUE_NAME)

    def send(self, subject, investment: StockInvestment):
        request = AsyncInvestmentAddRequest(subject, InvestmentsType.STOCK, investment.to_dict())
        self._queue.send_message(MessageBody=JsonUtils.dump(asdict(request)))
