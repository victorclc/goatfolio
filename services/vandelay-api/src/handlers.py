import traceback
from http import HTTPStatus

from adapters import ImportsRepository, CEIImportsQueue, PortfolioClient
from core import CEICore
from exceptions import UnprocessableException
from goatcommons.notifications.client import PushNotificationsClient
from goatcommons.shit.client import ShitNotifierClient
from goatcommons.shit.models import NotifyLevel
from goatcommons.utils import JsonUtils, AWSEventUtils
from models import CEIInboundRequest, CEIImportResult
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s | %(funcName)s %(levelname)-s: %(message)s')
logger = logging.getLogger()
logger.setLevel(logging.INFO)

core = CEICore(repo=ImportsRepository(), queue=CEIImportsQueue(), portfolio=PortfolioClient(),
               push=PushNotificationsClient())


def cei_import_request_handler(event, context):
    try:
        request = CEIInboundRequest(**JsonUtils.load(event['body']))
        subject = AWSEventUtils.get_event_subject(event)

        core.import_request(subject, request)
        return {'statusCode': HTTPStatus.ACCEPTED.value,
                'body': JsonUtils.dump({"message": HTTPStatus.ACCEPTED.phrase})}
    except TypeError as e:
        logger.exception(e)
        return {'statusCode': HTTPStatus.BAD_REQUEST.value, 'body': JsonUtils.dump({"message": str(e)})}
    except UnprocessableException as e:
        logger.exception(e)
        return {'statusCode': HTTPStatus.UNPROCESSABLE_ENTITY.value, 'body': JsonUtils.dump({"message": str(e)})}


def cei_import_result_handler(event, context):
    logger.info(f'EVENT: {event}')
    try:
        for message in event['Records']:
            core.import_result(CEIImportResult(**JsonUtils.load(message['body'])))
        return {'statusCode': HTTPStatus.OK.value, 'body': JsonUtils.dump({"message": HTTPStatus.OK.phrase})}
    except Exception as e:
        logger.exception(e)
        ShitNotifierClient().send(NotifyLevel.ERROR, 'VANDELAY-API',
                                  f'CEI IMPORT RESULT FAILED  {traceback.format_exc()}')

        raise


def cei_import_status_handler(event, context):
    pass


if __name__ == '__main__':
    event ={'Records': [{'messageId': 'da3866d0-11da-4569-9447-0d476f304660', 'receiptHandle': 'AQEBNhfMu90AE/4BAQCrJfyoArcJsfzHlBIVY3Sql7BUGhP03UnAvr99p0JQG3WoygpUy+MbkYAyNCuR5fZXFPapImTnF6A8NREBDIj6gw+a2anJrMwQdZZ3rbcN4TIHEVuzO1D1QYgXN0zH86XdPO1l7B4v/v+s/7j/VI8BBrThQ5hGifuUNzyUHaZGZ3On/21Orjn94oHdBevi84Xa9j+VgGgjmHP83PbMOb+Yph8ICT7nwTdB6AqoPCY3RaHUGj+zaNp0Ah7tePp2mbRf6Gm3sioltpdpxlWsQZghQwKYid5qGt1ibWlh8ejcU92Yxaahr7IKshuKYmwUehZJ3VxksGR4gsuUUF5BYnWFK62CfYuutYMWNZmxi+aAaJOYEEkCdD+orMY/jnBTHjV5//6q3A==', 'body': '{"subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "datetime": 1629839312, "status": "SUCCESS", "payload": [{"amount": 100.0, "price": 35.14, "ticker": "MDIA3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMDIA3160488000010035141", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 83.71, "ticker": "WEGE3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIWEGE3160488000010083711", "costs": 0.0, "alias_ticker": ""}, {"amount": 1.0, "price": 10.38, "ticker": "ITSA4", "operation": "BUY", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41604880000110381", "costs": 0.0, "alias_ticker": ""}, {"amount": 62.0, "price": 10.38, "ticker": "ITSA4", "operation": "BUY", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA416048800006210381", "costs": 0.0, "alias_ticker": ""}, {"amount": 21.0, "price": 10.38, "ticker": "ITSA4", "operation": "BUY", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA416048800002110381", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 64.18, "ticker": "ARZZ3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIARZZ316048800001064181", "costs": 0.0, "alias_ticker": ""}, {"amount": 40.0, "price": 60.06, "ticker": "BIDI11", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1116048800004060061", "costs": 0.0, "alias_ticker": ""}, {"amount": 13.0, "price": 28.88, "ticker": "FLRY3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIFLRY316048800001328881", "costs": 0.0, "alias_ticker": ""}, {"amount": 56.0, "price": 35.11, "ticker": "MDIA3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMDIA316048800005635111", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 22.5, "ticker": "SQIA3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA31604880000522501", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 22.5, "ticker": "SQIA3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA31604880000422501", "costs": 0.0, "alias_ticker": ""}, {"amount": 6.0, "price": 22.5, "ticker": "SQIA3", "operation": "SELL", "date": 1604880000, "type": "STOCK", "broker": "308 - CLEAR CORRETORA - GRUPO XP", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA31604880000622501", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 49.05, "ticker": "MGLU3", "operation": "BUY", "date": 1583366400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU315833664001049051", "costs": 0.0, "alias_ticker": ""}, {"amount": 25.0, "price": 21.87, "ticker": "SQIA3", "operation": "BUY", "date": 1583366400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA315833664002521871", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 39.0, "ticker": "BIDI11", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583452800439001", "costs": 0.0, "alias_ticker": ""}, {"amount": 1.0, "price": 39.0, "ticker": "BIDI11", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583452800139001", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 39.0, "ticker": "BIDI11", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583452800539001", "costs": 0.0, "alias_ticker": ""}, {"amount": 8.0, "price": 11.45, "ticker": "ITSA4", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41583452800811451", "costs": 0.0, "alias_ticker": ""}, {"amount": 9.0, "price": 11.45, "ticker": "ITSA4", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41583452800911451", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 44.07, "ticker": "MGLU3", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU31583452800544071", "costs": 0.0, "alias_ticker": ""}, {"amount": 20.0, "price": 19.39, "ticker": "SQIA3", "operation": "BUY", "date": 1583452800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA315834528002019391", "costs": 0.0, "alias_ticker": ""}, {"amount": 15.0, "price": 31.6, "ticker": "BIDI11", "operation": "BUY", "date": 1583712000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1115837120001531601", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 39.68, "ticker": "MGLU3", "operation": "BUY", "date": 1583712000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU315837120001039681", "costs": 0.0, "alias_ticker": ""}, {"amount": 7.0, "price": 29.4, "ticker": "BIDI11", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583884800729401", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 29.4, "ticker": "BIDI11", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583884800429401", "costs": 0.0, "alias_ticker": ""}, {"amount": 20.0, "price": 24.68, "ticker": "FLRY3", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIFLRY315838848002024681", "costs": 0.0, "alias_ticker": ""}, {"amount": 30.0, "price": 10.27, "ticker": "ITSA4", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA415838848003010271", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 9.97, "ticker": "ITSA4", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41583884800109971", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 17.04, "ticker": "SQIA3", "operation": "BUY", "date": 1583884800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA315838848001017041", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 25.0, "ticker": "BIDI11", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583971200525001", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 25.0, "ticker": "BIDI11", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI111583971200525002", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 23.4, "ticker": "BIDI11", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1115839712001023401", "costs": 0.0, "alias_ticker": ""}, {"amount": 30.0, "price": 9.11, "ticker": "ITSA4", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41583971200309111", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 34.32, "ticker": "MGLU3", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU315839712001034321", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 31.54, "ticker": "MGLU3", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU31583971200531541", "costs": 0.0, "alias_ticker": ""}, {"amount": 48.0, "price": 12.74, "ticker": "MYPK3", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMYPK315839712004812741", "costs": 0.0, "alias_ticker": ""}, {"amount": 2.0, "price": 12.74, "ticker": "MYPK3", "operation": "BUY", "date": 1583971200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMYPK31583971200212741", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 17.5, "ticker": "AZUL4", "operation": "BUY", "date": 1584316800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIAZUL4158431680010017501", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 11.34, "ticker": "SQIA3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA3158448960010011341", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 5.97, "ticker": "VVAR3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVVAR315844896001005971", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 4.89, "ticker": "VVAR3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVVAR315844896001004891", "costs": 0.0, "alias_ticker": ""}, {"amount": 25.0, "price": 19.78, "ticker": "FLRY3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIFLRY315844896002519781", "costs": 0.0, "alias_ticker": ""}, {"amount": 18.0, "price": 9.13, "ticker": "ITSA4", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41584489600189131", "costs": 0.0, "alias_ticker": ""}, {"amount": 37.0, "price": 9.13, "ticker": "ITSA4", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA41584489600379131", "costs": 0.0, "alias_ticker": ""}, {"amount": 15.0, "price": 33.13, "ticker": "MGLU3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU315844896001533131", "costs": 0.0, "alias_ticker": ""}, {"amount": 35.0, "price": 13.6, "ticker": "SQIA3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEISQIA315844896003513601", "costs": 0.0, "alias_ticker": ""}, {"amount": 20.0, "price": 26.28, "ticker": "WEGE3", "operation": "BUY", "date": 1584489600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIWEGE315844896002026281", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 4.67, "ticker": "VVAR3", "operation": "BUY", "date": 1585699200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVVAR315856992001004671", "costs": 0.0, "alias_ticker": ""}, {"amount": 15.0, "price": 32.2, "ticker": "WEGE3", "operation": "BUY", "date": 1585699200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIWEGE315856992001532201", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 25.96, "ticker": "BIDI11", "operation": "BUY", "date": 1587686400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI11158768640010025961", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 8.38, "ticker": "ITSA4", "operation": "BUY", "date": 1587686400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA415876864001008381", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 12.0, "ticker": "MYPK3", "operation": "BUY", "date": 1587686400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMYPK315876864001012001", "costs": 0.0, "alias_ticker": ""}, {"amount": 40.0, "price": 12.19, "ticker": "MYPK3", "operation": "BUY", "date": 1587686400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMYPK315876864004012191", "costs": 0.0, "alias_ticker": ""}, {"amount": 15.0, "price": 37.08, "ticker": "WEGE3", "operation": "BUY", "date": 1587686400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIWEGE315876864001537081", "costs": 0.0, "alias_ticker": ""}, {"amount": 16.0, "price": 107.9, "ticker": "ALZR11", "operation": "BUY", "date": 1589932800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIALZR11158993280016107901", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 107.9, "ticker": "ALZR11", "operation": "BUY", "date": 1589932800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIALZR1115899328004107901", "costs": 0.0, "alias_ticker": ""}, {"amount": 12.0, "price": 84.4, "ticker": "BCFF11", "operation": "BUY", "date": 1589932800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF1115899328001284401", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 181.92, "ticker": "IVVB11", "operation": "BUY", "date": 1589932800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIIVVB11158993280010181921", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 179.46, "ticker": "IVVB11", "operation": "BUY", "date": 1594252800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIIVVB11159425280010179461", "costs": 0.0, "alias_ticker": ""}, {"amount": 23.0, "price": 90.2, "ticker": "RBRP11", "operation": "BUY", "date": 1594252800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1115942528002390201", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 21.92, "ticker": "AZUL4", "operation": "SELL", "date": 1595289600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIAZUL4159528960010021921", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 20.76, "ticker": "VVAR3", "operation": "SELL", "date": 1595289600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVVAR3159528960010020761", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 20.8, "ticker": "VVAR3", "operation": "SELL", "date": 1595289600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVVAR3159528960010020801", "costs": 0.0, "alias_ticker": ""}, {"amount": 19.0, "price": 88.1, "ticker": "RBRP11", "operation": "BUY", "date": 1597104000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1115971040001988101", "costs": 0.0, "alias_ticker": ""}, {"amount": 22.0, "price": 88.1, "ticker": "RBRP11", "operation": "BUY", "date": 1597104000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1115971040002288101", "costs": 0.0, "alias_ticker": ""}, {"amount": 16.0, "price": 91.07, "ticker": "RBRP11", "operation": "BUY", "date": 1599696000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1115996960001691071", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 8.97, "ticker": "ITSA4", "operation": "BUY", "date": 1600646400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIITSA416006464001008971", "costs": 0.0, "alias_ticker": ""}, {"amount": 25.0, "price": 51.5, "ticker": "BIDI11", "operation": "BUY", "date": 1600646400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1116006464002551501", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600590571", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600490571", "costs": 0.0, "alias_ticker": ""}, {"amount": 4.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600490572", "costs": 0.0, "alias_ticker": ""}, {"amount": 5.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600590572", "costs": 0.0, "alias_ticker": ""}, {"amount": 2.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600290571", "costs": 0.0, "alias_ticker": ""}, {"amount": 3.0, "price": 90.57, "ticker": "BCFF11", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111602201600390571", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 95.7, "ticker": "MGLU3", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU316022016001095701", "costs": 0.0, "alias_ticker": ""}, {"amount": 32.0, "price": 95.7, "ticker": "MGLU3", "operation": "BUY", "date": 1602201600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIMGLU316022016003295701", "costs": 0.0, "alias_ticker": ""}, {"amount": 10.0, "price": 92.2, "ticker": "RBRP11", "operation": "BUY", "date": 1605139200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1116051392001092201", "costs": 0.0, "alias_ticker": ""}, {"amount": 36.0, "price": 92.2, "ticker": "RBRP11", "operation": "BUY", "date": 1605139200, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIRBRP1116051392003692201", "costs": 0.0, "alias_ticker": ""}, {"amount": 71.0, "price": 114.4, "ticker": "VGIP11", "operation": "BUY", "date": 1612828800, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVGIP11161282880071114401", "costs": 0.0, "alias_ticker": ""}, {"amount": 200.0, "price": 29.01, "ticker": "BBAS3", "operation": "BUY", "date": 1613952000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBBAS3161395200020029011", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 96.55, "ticker": "VALE3", "operation": "BUY", "date": 1614297600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVALE3161429760010096551", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 94.6, "ticker": "VALE3", "operation": "SELL", "date": 1614902400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIVALE3161490240010094601", "costs": 0.0, "alias_ticker": ""}, {"amount": 7.0, "price": 160.5, "ticker": "BIDI11", "operation": "SELL", "date": 1614902400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1116149024007160501", "costs": 0.0, "alias_ticker": ""}, {"amount": 22.0, "price": 160.5, "ticker": "BIDI11", "operation": "SELL", "date": 1614902400, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI11161490240022160501", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 11.93, "ticker": "XINA11", "operation": "BUY", "date": 1615248000, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIXINA11161524800010011931", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 74.65, "ticker": "AAPL34", "operation": "BUY", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIAAPL34161818560010074651", "costs": 0.0, "alias_ticker": ""}, {"amount": 100.0, "price": 49.2, "ticker": "BABA34", "operation": "BUY", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBABA34161818560010049201", "costs": 0.0, "alias_ticker": ""}, {"amount": 19.0, "price": 85.65, "ticker": "BCFF11", "operation": "BUY", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF1116181856001985651", "costs": 0.0, "alias_ticker": ""}, {"amount": 2.0, "price": 85.65, "ticker": "BCFF11", "operation": "BUY", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111618185600285651", "costs": 0.0, "alias_ticker": ""}, {"amount": 3.0, "price": 85.65, "ticker": "BCFF11", "operation": "BUY", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBCFF111618185600385651", "costs": 0.0, "alias_ticker": ""}, {"amount": 31.0, "price": 188.02, "ticker": "BIDI11", "operation": "SELL", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI11161818560031188021", "costs": 0.0, "alias_ticker": ""}, {"amount": 6.0, "price": 188.01, "ticker": "BIDI11", "operation": "SELL", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI1116181856006188011", "costs": 0.0, "alias_ticker": ""}, {"amount": 45.0, "price": 188.01, "ticker": "BIDI11", "operation": "SELL", "date": 1618185600, "type": "STOCK", "broker": "1099 - INTER DTVM LTDA", "external_system": "CEI", "subject": "41e4a793-3ef5-4413-82e2-80919bce7c1a", "id": "CEIBIDI11161818560045188011", "costs": 0.0, "alias_ticker": ""}], "login_error": false}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1629839385284', 'SenderId': 'AROASAORJHNPF42FTSGDK:cei-crawler-dev-ceiExtractHandler', 'ApproximateFirstReceiveTimestamp': '1629839385301'}, 'messageAttributes': {}, 'md5OfBody': '0b1b0603424c8a3bf6ea49f3b99197f8', 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:sa-east-1:138414734174:CeiImportResult', 'awsRegion': 'sa-east-1'}]}
    cei_import_result_handler(event, None)